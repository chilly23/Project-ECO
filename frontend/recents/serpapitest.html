<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>People Radar</title>

  <!-- X Embed Script -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  

  <style>
    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, sans-serif;
      background: #0b0b0b;
      color: #fff;
    }

    h2 { margin-bottom: 12px }

    input {
      width: 360px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      outline: none;
    }

    button {
      margin-left: 8px;
      padding: 12px 18px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .loader {
      margin-top: 16px;
      opacity: 0.7;
    }

    .bento {
      margin-top: 28px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 18px;
      align-items: start;
    }

    .card {
      background: #151515;
      border-radius: 16px;
      padding: 14px;
    }

    .news-card img {
      width: 100%;
      border-radius: 12px;
      margin-bottom: 10px;
    }

    a {
      color: #7dd3fc;
      text-decoration: none;
      font-weight: 600;
    }

    .meta {
      font-size: 13px;
      opacity: 0.7;
      margin-top: 6px;
    }

    .x-card {
  background: transparent;
  min-height: 320px;
  overflow: visible;
}


    .section {
      grid-column: 1 / -1;
      opacity: 0.8;
      margin-top: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
  </style>
</head>

<body>

<h2>People Radar</h2>

<input id="query" placeholder="Enter name (e.g. Satya Nadella)" />
<button onclick="search()">Search</button>

<div id="status" class="loader"></div>
<div id="results" class="bento"></div>

<script>
const API_KEY = "AIzaSyDObv6ZowtHDhU1zmhDSwalW_b-gZn5-j4";
const CX = "3144ca98089234e28";

/* ===== Google Search (paged) ===== */
async function fetchPaged(query, pages = 2) {
  const out = [];
  for (let i = 0; i < pages; i++) {
    const start = 1 + i * 10;
    const url =
      `https://www.googleapis.com/customsearch/v1` +
      `?q=${encodeURIComponent(query)}` +
      `&num=10&start=${start}` +
      `&key=${API_KEY}&cx=${CX}`;

    const res = await fetch(url);
    const json = await res.json();
    if (json.items) out.push(...json.items);
  }
  return out;
}

/* ===== Main Flow ===== */
async function search() {
  const name = document.getElementById("query").value.trim();
  const status = document.getElementById("status");
  const results = document.getElementById("results");

  if (!name) return;

  results.innerHTML = "";
  status.textContent = "Loading news, X posts, and LinkedIn…";

  const [newsRaw, xRaw, liRaw] = await Promise.all([
    fetchPaged(`recent news on ${name}`, 3),
    fetchPaged(`site:x.com OR site:twitter.com ${name}`, 2),
    fetchPaged(`site:linkedin.com ${name}`, 2)
  ]);

  renderAll(process(newsRaw, xRaw, liRaw));
  status.textContent = "";
}

/* ===== Processing ===== */
function process(newsRaw, xRaw, liRaw) {
  const news = [];
  const x = [];
  const linkedin = [];

  const getDate = i =>
    i.pagemap?.metatags?.[0]?.["article:published_time"] ||
    new Date().toISOString();

  newsRaw.forEach(i => {
    news.push({
      title: i.title,
      link: i.link,
      image: i.pagemap?.cse_image?.[0]?.src || null,
      source: new URL(i.link).hostname,
      date: getDate(i)
    });
  });

  xRaw.forEach(i => {
    if (i.link.includes("/status/")) {
      x.push({ link: i.link, date: getDate(i) });
    }
  });

  liRaw.forEach(i => {
    linkedin.push({
      title: i.title,
      link: i.link,
      date: getDate(i)
    });
  });

  return {
    news: news.slice(0, 20),
    x: x.slice(0, 8),
    linkedin: linkedin.slice(0, 8)
  };
}

  

async function fetchOEmbed(tweetUrl) {
    if (!tweetUrl) {
      return { statusCode: 400, body: "Missing url" };
    }
  const res = await fetch(
      `https://publish.twitter.com/oembed?omit_script=true&url=${encodeURIComponent(tweetUrl)}`
    );
  return res.json();
}


/* ===== Rendering ===== */
function renderAll({ news, x, linkedin }) {
  const root = document.getElementById("results");

  root.innerHTML += `<div class="section">Latest News</div>`;
  news.forEach(n => {
    const c = document.createElement("div");
    c.className = "card news-card";
    c.innerHTML = `
      ${n.image ? `<img src="${n.image}">` : ""}
      <a href="${n.link}" target="_blank">${n.title}</a>
      <div class="meta">${n.source}</div>
    `;
    root.appendChild(c);
  });

  root.innerHTML += `<div class="section">X Activity</div>`;

  x.forEach(async p => {
    const c = document.createElement("div");
    c.className = "card x-card";
    c.innerHTML = `<div class="meta">Loading post…</div>`;
    root.appendChild(c);

    try {
      const embed = await fetchOEmbed(p.link);
      c.innerHTML = embed.html;

      if (window.twttr?.widgets) {
        twttr.widgets.load(c);
      }
    } catch (e) {
      c.innerHTML = `
        <a href="${p.link}" target="_blank">View post on X</a>
      `;
    }
  });


  root.innerHTML += `<div class="section">LinkedIn</div>`;
  linkedin.forEach(p => {
    const c = document.createElement("div");
    c.className = "card";
    c.innerHTML = `
      <a href="${p.link}" target="_blank">${p.title}</a>
      <div class="meta">LinkedIn</div>
    `;
    root.appendChild(c);
  });

  /* Re-hydrate X embeds */
  if (window.twttr?.widgets) {
    twttr.widgets.load(document.getElementById("results"));
  }
}
</script>

</body>
</html>
y